# SettleUp Deployment Guide

## Prerequisites

- Node.js 18+ installed
- Supabase account with project created
- Vercel account (or any hosting platform)
- Git installed

---

## Local Development Setup

### 1. Clone the Repository

```bash
git clone https://github.com/yourusername/settleup.git
cd settleup
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Set Up Environment Variables

Create `.env.local` file in the root directory:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

**Get these values from**:
1. Go to your Supabase project dashboard
2. Navigate to Settings → API
3. Copy Project URL and anon/public key

### 4. Set Up Supabase Database

1. Go to Supabase Dashboard → SQL Editor
2. Run the schema from `supabase/schema.sql`
3. Verify tables are created
4. Check RLS policies are enabled

### 5. Run Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000)

---

## Deployment to Vercel

### Option 1: Deploy via Vercel CLI

```bash
# Install Vercel CLI
npm i -g vercel

# Login to Vercel
vercel login

# Deploy
vercel
```

### Option 2: Deploy via Vercel Dashboard

1. **Push to GitHub**:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/yourusername/settleup.git
   git push -u origin main
   ```

2. **Connect to Vercel**:
   - Go to [vercel.com/new](https://vercel.com/new)
   - Import your GitHub repository
   - Configure project settings

3. **Add Environment Variables**:
   - In Vercel project settings
   - Navigate to Environment Variables
   - Add:
     - `NEXT_PUBLIC_SUPABASE_URL`
     - `NEXT_PUBLIC_SUPABASE_ANON_KEY`

4. **Deploy**:
   - Click "Deploy"
   - Wait for build to complete
   - Your app is live!

---

## Environment Variables

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase project URL | `https://xxxxx.supabase.co` |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase anonymous key | `eyJhbGciOiJIUz...` |

### Optional Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `NODE_ENV` | Environment mode | `production` |

---

## Build Commands

```bash
# Development
npm run dev

# Production build
npm run build

# Start production server
npm start

# Lint code
npm run lint
```

---

## PWA Configuration

The app is configured as a Progressive Web App (PWA).

### Service Worker

- Automatically generated by `next-pwa`
- Caches static assets (fonts, images, styles)
- Enables offline functionality
- Updates automatically

### Install as App

**Desktop**:
1. Open the deployed URL
2. Look for "Install" button in address bar
3. Click to install

**Mobile**:
1. Open URL in browser
2. Tap "Share" → "Add to Home Screen"
3. App appears on home screen

---

## Post-Deployment Checklist

- [ ] Verify app loads at deployment URL
- [ ] Test user signup/login
- [ ] Create a test group
- [ ] Add test expense
- [ ] Verify settlements calculate correctly
- [ ] Test offline mode (disconnect network)
- [ ] Verify sync works when reconnected
- [ ] Test PWA install
- [ ] Check mobile responsiveness
- [ ] Verify SEO meta tags (view page source)
- [ ] Test on multiple browsers

---

## Troubleshooting

### Build Fails

**Issue**: TypeScript errors
**Solution**: Run `npm run lint` locally to fix errors before deploying

**Issue**: Missing environment variables
**Solution**: Ensure all required vars are set in Vercel dashboard

### Supabase Connection Issues

**Issue**: 401 Unauthorized
**Solution**: Check your Supabase keys are correct and RLS policies are enabled

**Issue**: Data not syncing
**Solution**: 
1. Check browser console for errors
2. Verify IndexedDB is initialized
3. Check network tab for failed requests

### PWA Not Installing

**Issue**: Install prompt doesn't appear
**Solution**: 
1. Ensure site is served over HTTPS
2. Check manifest.json is accessible
3. Verify service worker is registered (DevTools → Application → Service Workers)

---

## Performance Optimization

### Implemented Optimizations

- ✅ Service worker with aggressive caching
- ✅ Image optimization (Next.js Image component ready)
- ✅ Code splitting (Next.js automatic)
- ✅ Minification (SWC compiler)
- ✅ IndexedDB for fast local data access
- ✅ Optimistic UI updates

### Recommendations

1. **Add images**: Create icon files (192x192, 512x512)
2. **Lighthouse audit**: Run performance audit
3. **Monitor**: Set up error tracking (Sentry, LogRocket)
4. **Analytics**: Add usage analytics (Vercel Analytics)

---

## Maintenance

### Updating Dependencies

```bash
npm update
npm audit fix
```

### Database Migrations

1. Make schema changes in Supabase dashboard
2. Update TypeScript types in `lib/supabase/client.ts`
3. Update Dexie schema in `lib/db/index.ts`
4. Test locally before deploying

---

## Security Notes

- ✅ RLS policies protect user data
- ✅ Client-side encryption for sensitive data
- ✅ Environment variables for secrets
- ⚠️ Never commit `.env.local` to Git
- ⚠️ Rotate Supabase keys if compromised

---

## Support & Resources

- **Documentation**: `/docs` (this file)
- **Supabase Docs**: https://supabase.com/docs
- **Next.js Docs**: https://nextjs.org/docs
- **Vercel Support**: https://vercel.com/support

---

## License

MIT License - See LICENSE file
